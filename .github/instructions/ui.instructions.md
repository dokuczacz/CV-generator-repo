---
applyTo: "ui/**/*.{ts,tsx,js,jsx}"
name: Next.js UI conventions
description: Best practices for React/Next.js code in this repository
---

# Next.js 14 UI Conventions

## Component Structure

- **Server Components by default:** Use Server Components unless you need state/events.
- **Client Components:** Mark with `"use client"` only when needed (state, events, hooks).
- **Props drilling:** Avoid passing props through 3+ levels; use context or pass children.
- **No large components:** Break down large components into smaller, reusable units.

Example:
```tsx
// app/page.tsx (Server Component by default)
export default async function Home() {
  return <ChatInterface />;
}

// ChatInterface.tsx (Client Component — has state)
"use client";
import { useState } from "react";

export function ChatInterface() {
  const [messages, setMessages] = useState([]);
  return <div>{messages.map(m => <Message key={m.id} {...m} />)}</div>;
}
```

## API Routes

- **Location:** `/app/api/<endpoint>/route.ts`
- **Pattern:** Export `GET`, `POST`, `PUT`, `DELETE` as needed.
- **Request handling:** Use `req.json()` for JSON, validate input.
- **Error responses:** Return consistent error format: `{ error: string, status: number }`.

Example:
```typescript
// app/api/process-cv/route.ts
export async function POST(req: Request) {
  try {
    const body = await req.json();
    // Validate
    if (!body.docx_base64) {
      return Response.json({ error: "Missing docx_base64" }, { status: 400 });
    }
    // Process
    const result = await processCv(body);
    return Response.json(result);
  } catch (error) {
    console.error("Error:", error);
    return Response.json({ error: String(error) }, { status: 500 });
  }
}
```

## State Management

- **useState for simple state:** Use for local component state.
- **Context for global state:** Use React Context for auth, user prefs, theme.
- **No external store (Redux, Zustand):** Keep it simple; add only if needed.
- **useCallback for memoization:** Use to prevent unnecessary re-renders of passed functions.

## Styling

- **Tailwind CSS:** Use Tailwind classes (no inline styles unless dynamic).
- **CSS Modules:** Not needed; Tailwind handles most cases.
- **Dynamic classes:** Use `clsx()` or `classNames()` for conditional classes.

Example:
```tsx
import clsx from 'clsx';

<button className={clsx('px-4 py-2', { 'bg-blue-500': active, 'bg-gray-300': !active })}>
  Click me
</button>
```

## Imports & Dependencies

- **Import order:** React → Next → third-party → local.
- **No unused imports:** Remove before commit.
- **Minimal dependencies:** Prefer built-ins (e.g., `fetch` over `axios`).
- **Pin versions:** In `package.json`, use exact versions (no `^` or `~`).

## Environment Variables

- **Frontend vars:** Store in `ui/.env.local` (git-ignored).
- **Prefix:** Use `NEXT_PUBLIC_` for vars exposed to browser (e.g., `NEXT_PUBLIC_API_URL`).
- **Secrets:** Keep `OPENAI_API_KEY` server-side (in `.env.local`, not exposed).
- **Reference:** Use `process.env.NEXT_PUBLIC_*` in code.

## TypeScript

- **Strict mode:** Always use strict TypeScript (no `any` unless unavoidable).
- **Type interfaces:** Define clear interfaces for data structures.
- **Props typing:** Type all component props explicitly.

Example:
```typescript
interface ChatMessage {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
}

interface ChatInterfaceProps {
  messages: ChatMessage[];
  onSendMessage: (message: string) => Promise<void>;
}

export function ChatInterface({ messages, onSendMessage }: ChatInterfaceProps) {
  // ...
}
```

## Testing

- **Playwright:** Use for end-to-end tests (not unit tests in Next.js).
- **Test location:** `/tests/` at repo root.
- **Test artifacts:** Generated by `npm run pretest` (fixtures, screenshots).
- **No hardcoded URLs:** Use env vars for test endpoints.

## Performance

- **Image optimization:** Use `next/image` component.
- **Code splitting:** Next.js handles automatically.
- **Lazy loading:** Use `dynamic()` for heavy components.
- **Build checks:** Run `npm run build` before commit.

## Avoid

- ❌ Fetching data in Server Components without `async`/`await`.
- ❌ Large inline functions in render (extract to separate functions).
- ❌ Forgetting `"use client"` when using hooks.
- ❌ Unoptimized images (use `next/image`).
- ❌ Importing entire lodash (import specific functions).
- ❌ Global CSS imports in multiple places (do once in layout).

## References

- [Next.js 14 Documentation](https://nextjs.org/docs)
- [React Server Components](https://react.dev/reference/react/use-client)
- [Tailwind CSS](https://tailwindcss.com)
- [TypeScript Best Practices](https://www.typescriptlang.org/docs/handbook/)

